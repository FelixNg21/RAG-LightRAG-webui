{% extends 'base.html' %}

{% block head %}
<link rel="stylesheet" href="{{url_for('static', filename='css/main.css') }}">
{% endblock %}

{% block body %}
<div id="chat-log"></div>
<form id="query-form" action="/query" method="post">
    <textarea id="query-text" name="query" rows="1" placeholder="Enter your query here..."></textarea>
    <input type="submit" value="Submit"/>
</form>
<script>
    document.getElementById('query-form').addEventListener('submit', function (event) {
        event.preventDefault(); // Prevent the default form submission

        let queryText = document.getElementById('query-text').value;
        let chatLog = document.getElementById('chat-log');

        // Append user query to chat log
        let userQueryDiv = document.createElement('div');
        userQueryDiv.className = 'user-query';
        userQueryDiv.textContent = 'You: ' + queryText;
        chatLog.appendChild(userQueryDiv);

        let formData = new FormData(this);

        fetch(this.action, {
            method: 'POST',
            body: formData
        })
            .then(response => response.text())
            .then(data => {
                // Append chatbot response to chat log
                let chatbotResponseDiv = document.createElement('div');
                chatbotResponseDiv.className = 'chatbot-response';
                chatbotResponseDiv.textContent = 'Chatbot: ' + data;

                chatLog.appendChild(chatbotResponseDiv);
            })
            .catch(error => {
                console.error('Error:', error);
            });
    });
</script>
{% endblock %}